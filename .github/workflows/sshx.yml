name: üöÄ SSHX REDIRECT (HOSTED ON RDP REPO)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian ch·∫°y'
        default: '12h'
        type: choice
        options: ['1h', '3h', '6h', '12h']

jobs:
  Deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: üì• CHECKOUT
        uses: actions/checkout@v4

- name: üì• C√ÄI ƒê·∫∂T SSHX (B·∫¢N FIX TO√ÄN DI·ªÜN)
        run: |
          # 1. Ch·∫°y script c√†i ƒë·∫∑t chu·∫©n
          curl -sSf https://sshx.io/get | sh
          
          # 2. T√¨m v·ªã tr√≠ file sshx v·ª´a c√†i
          # Th·ª≠ t√¨m trong /usr/local/bin (v·ªã tr√≠ h·ªá th·ªëng) ho·∫∑c th∆∞ m·ª•c Home
          SSHX_PATH=$(which sshx || find $HOME -name sshx -type f | head -n 1)
          
          if [ -z "$SSHX_PATH" ]; then
            echo "‚ùå Kh√¥ng t√¨m th·∫•y file sshx sau khi c√†i ƒë·∫∑t!"
            exit 1
          fi
          
          echo "‚úÖ T√¨m th·∫•y sshx t·∫°i: $SSHX_PATH"
          cp "$SSHX_PATH" ./sshx
          chmod +x ./sshx

      - name: üåê KH·ªûI CH·∫†Y ROOT SSHX & L·∫§Y URL
        run: |
          # Ch·∫°y file sshx ƒë√£ copy ra th∆∞ m·ª•c hi·ªán t·∫°i
          sudo ./sshx > sshx_log.txt 2>&1 &
          
          echo "‚è≥ ƒêang ƒë·ª£i link SSHX..."
          sleep 12
          
          # Tr√≠ch xu·∫•t FULL URL
          SSHX_URL=$(grep -o 'https://sshx.io/s/[^[:space:]]*' sshx_log.txt | head -n 1)
          
          if [ -z "$SSHX_URL" ]; then
            echo "‚ùå L·ªói: Kh√¥ng l·∫•y ƒë∆∞·ª£c URL t·ª´ log!"
            cat sshx_log.txt
            exit 1
          fi
          
          echo "URL=$SSHX_URL" >> $GITHUB_ENV
          echo "üîó URL C·ªßa ToiLaSkidder: $SSHX_URL"
      - name: ‚ö° PUSH TO GH-PAGES (BRANCH RI√äNG)
        run: |
          # T·∫°o file redirect
          echo "<html><head><script>location.replace('${{ env.URL }}')</script></head></html>" > index.html
          
          # File CNAME ƒë·ªãnh danh cho Domain ri√™ng c·ªßa b·∫°n
          echo "ssh.nghuyzzz.qzz.io" > CNAME
          
          # C·∫•u h√¨nh Git
          git config --global user.name "ToiLaSkidder"
          git config --global user.email "ToiLaSkidder@users.noreply.github.com"
          
          # ƒê·∫©y l√™n nh√°nh gh-pages c·ªßa repo RDP (kh√¥ng ·∫£nh h∆∞·ªüng nh√°nh main)
          git checkout --orphan gh-pages
          git rm -rf .
          git add index.html CNAME
          git commit -m "üöÄ Update Terminal Link"
          git push origin gh-pages --force
          
      - name: ‚è≥ KEEP ALIVE
        run: |
          case "${{ github.event.inputs.duration }}" in
            "1h") sleep 3600 ;;
            "3h") sleep 10800 ;;
            "6h") sleep 21600 ;;
            "12h") sleep 43200 ;;
          esac
