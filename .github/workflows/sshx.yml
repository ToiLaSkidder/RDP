name: üöÄ SSHX FOR TOILASKIDDER (RDP REPO)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian duy tr√¨'
        default: '12h'
        type: choice
        options: ['1h', '3h', '6h', '12h']

jobs:
  Deploy-Redirect:
    runs-on: ubuntu-latest
    permissions:
      contents: write # Quy·ªÅn quan tr·ªçng ƒë·ªÉ push v√†o nh√°nh gh-pages
      
    steps:
      - name: üì• CHECKOUT CODE
        uses: actions/checkout@v4

      - name: üì• C√ÄI ƒê·∫∂T SSHX (SMART SEARCH)
        run: |
          # 1. C√†i ƒë·∫∑t b·∫±ng script ch√≠nh ch·ªß
          curl -sSf https://sshx.io/get | sh
          
          # 2. T√¨m v·ªã tr√≠ ch√≠nh x√°c c·ªßa file th·ª±c thi (cho d√π n√≥ ·ªü /usr/local/bin hay .sshx)
          SSHX_BIN=$(which sshx || find $HOME -name sshx -type f | head -n 1)
          
          if [ -z "$SSHX_BIN" ]; then
            echo "‚ùå Kh√¥ng t√¨m th·∫•y file sshx sau khi c√†i ƒë·∫∑t!"
            exit 1
          fi
          
          # 3. Copy ra th∆∞ m·ª•c hi·ªán t·∫°i ƒë·ªÉ s·ª≠ d·ª•ng
          cp "$SSHX_BIN" ./sshx_bin
          chmod +x ./sshx_bin
          echo "‚úÖ ƒê√£ s·∫µn s√†ng: ./sshx_bin"

      - name: üåê KH·ªûI CH·∫†Y ROOT SSHX
        run: |
          # Ch·∫°y v·ªõi sudo ƒë·ªÉ c√≥ quy·ªÅn Root ho√†n to√†n
          sudo ./sshx_bin > sshx_log.txt 2>&1 &
          
          echo "‚è≥ ƒêang t·∫°o link k·∫øt n·ªëi..."
          sleep 12
          
          # Tr√≠ch xu·∫•t FULL URL (L·∫•y s·∫°ch m·ªçi k√Ω t·ª± sau d·∫•u #)
          SSHX_URL=$(grep -o 'https://sshx.io/s/[^[:space:]]*' sshx_log.txt | head -n 1)
          
          if [ -z "$SSHX_URL" ]; then
            echo "‚ùå L·ªói: Kh√¥ng l·∫•y ƒë∆∞·ª£c URL. N·ªôi dung log:"
            cat sshx_log.txt
            exit 1
          fi
          
          echo "URL_FINAL=$SSHX_URL" >> $GITHUB_ENV
          echo "üîó Terminal c·ªßa b·∫°n: $SSHX_URL"

      - name: ‚ö° PUSH REDIRECT TO GH-PAGES
        run: |
          # 1. T·∫°o trang redirect (S·ª≠ d·ª•ng replace ƒë·ªÉ kh√¥ng l∆∞u l·ªãch s·ª≠ tr√¨nh duy·ªát)
          echo "<html><head><script>location.replace('${{ env.URL_FINAL }}')</script></head></html>" > index.html
          
          # 2. T·∫°o file CNAME ƒë·ªÉ gi·ªØ domain ri√™ng (Kh·ªõp v·ªõi c·∫•u h√¨nh Cloudflare)
          echo "ssh.nghuyzzz.qzz.io" > CNAME
          
          # 3. Thi·∫øt l·∫≠p Git nhanh
          git config --global user.name "ToiLaSkidder"
          git config --global user.email "ToiLaSkidder@users.noreply.github.com"
          
          # 4. T·∫°o nh√°nh gh-pages ƒë·ªôc l·∫≠p (Kh√¥ng l√†m b·∫©n nh√°nh main)
          git checkout --orphan gh-pages
          git rm -rf .
          git add index.html CNAME
          git commit -m "üöÄ Terminal Updated: $(date)"
          
          # 5. √âp push v√†o nh√°nh gh-pages
          git push origin gh-pages --force

      - name: ‚è≥ DUY TR√å H·ªÜ TH·ªêNG
        run: |
          echo "üïí H·ªá th·ªëng ƒëang ch·∫°y trong ${{ github.event.inputs.duration }}..."
          case "${{ github.event.inputs.duration }}" in
            "1h") sleep 3600 ;;
            "3h") sleep 10800 ;;
            "6h") sleep 21600 ;;
            "12h") sleep 43200 ;;
          esac
