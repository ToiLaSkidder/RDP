name: üöÄ SSHX REDIRECT FOR TOILASKIDDER

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian duy tr√¨'
        default: '12h'
        type: choice
        options: ['1h', '3h', '6h', '12h']

jobs:
  Deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: üì• CHECKOUT CODE
        uses: actions/checkout@v4

      - name: üì• C√ÄI ƒê·∫∂T SSHX
        run: |
          curl -sSf https://sshx.io/get | sh
          # T√¨m file th·ª±c thi b·∫•t k·ªÉ n√≥ n·∫±m ·ªü ƒë√¢u
          SSHX_BIN=$(which sshx || find $HOME -name sshx -type f | head -n 1)
          cp "$SSHX_BIN" ./sshx_bin
          chmod +x ./sshx_bin

      - name: üåê KH·ªûI CH·∫†Y ROOT SSHX
        run: |
          sudo ./sshx_bin > sshx_log.txt 2>&1 &
          sleep 12
          # Tr√≠ch xu·∫•t link bao g·ªìm c·∫£ ph·∫ßn token sau d·∫•u #
          SSHX_URL=$(grep -o 'https://sshx.io/s/[^[:space:]]*' sshx_log.txt | head -n 1)
          echo "URL_FINAL=$SSHX_URL" >> $GITHUB_ENV
          echo "‚úÖ Link Terminal: $SSHX_URL"

      - name: ‚ö° PUSH TO GH-PAGES
        run: |
          # 1. T·∫°o trang redirect (Static HTML)
          echo "<html><head><script>location.replace('${{ env.URL_FINAL }}')</script></head></html>" > index.html
          
          # 2. Quan tr·ªçng: T√™n mi·ªÅn c·ªßa b·∫°n
          echo "sshx.nghuyzzz.qzz.io" > CNAME
          
          # 3. √âp GitHub b·ªè qua Jekyll ƒë·ªÉ ch·∫°y nhanh h∆°n
          touch .nojekyll
          
          # 4. C·∫•u h√¨nh Git
          git config --global user.name "ToiLaSkidder"
          git config --global user.email "ToiLaSkidder@users.noreply.github.com"
          
          # 5. √âp push v√†o nh√°nh gh-pages c·ªßa repo RDP
          git checkout --orphan gh-pages
          git rm -rf .
          git add index.html CNAME .nojekyll
          git commit -m "üöÄ Terminal Updated: $(date)"
          git push origin gh-pages --force

      - name: ‚è≥ DUY TR√å PHI√äN
        run: |
          case "${{ github.event.inputs.duration }}" in
            "1h") sleep 3600 ;; "3h") sleep 10800 ;; "6h") sleep 21600 ;; "12h") sleep 43200 ;;
          esac
