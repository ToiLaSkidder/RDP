name: HACKER_VPS_PROVISIONING

on:
  repository_dispatch:
    types: [start-sshx]

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 360 

    steps:
      - name: ðŸ› ï¸ INITIALIZING VPS SYSTEM
        run: |
          echo ">>> [STATUS] PROVISIONING VPS CORE..."
          sudo apt-get update > /dev/null 2>&1
          
      - name: ðŸš€ DEPLOY TERMINAL GATEWAY
        run: |
          # 1. Táº£i vÃ  cÃ i Ä‘áº·t sshx
          curl -sSf https://sshx.io/get | sh
          
          # 2. Cháº¡y sshx vÃ  ghi log
          echo ">>> [SYSTEM] STARTING TUNNEL SERVICE..."
          /usr/local/bin/sshx > sshx_output.log 2>&1 &
          
          # 3. Äá»£i tunnel khá»Ÿi táº¡o (TÄƒng lÃªn 25s cho cháº¯c cháº¯n)
          sleep 25
          
          # 4. TRÃCH XUáº¤T LINK (Sá»¬ Dá»¤NG SED Äá»‚ Láº¤Y TOÃ€N Bá»˜ DÃ’NG)
          echo ">>> [ACCESS_LINK_START]"
          # Lá»‡nh nÃ y tÃ¬m dÃ²ng cÃ³ chá»©a https://sshx.io/s/ vÃ  láº¥y háº¿t toÃ n bá»™ dÃ²ng Ä‘Ã³ (bao gá»“m cáº£ dáº¥u #)
          sed -n '/https:\/\/sshx.io\/s\//p' sshx_output.log | head -n 1 | grep -o 'https://sshx.io/s/[^ ]*'
          echo ">>> [ACCESS_LINK_END]"
          
          echo "------------------------------------------------------------"
          echo ">>> [STATUS] VPS ACTIVE FOR 4 HOURS"
          echo "------------------------------------------------------------"
          
          # Giá»¯ workflow cháº¡y
          sleep 14400
