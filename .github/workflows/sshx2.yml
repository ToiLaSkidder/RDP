name: SSHX PRO SESSION
on:
  repository_dispatch:
    # T√™n n√†y ph·∫£i gi·ªëng h·ªát event_type trong server.js
    types: [start-sshx] 

jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: üöÄ Kh·ªüi ch·∫°y SSHX
        run: |
          # C√†i ƒë·∫∑t sshx
          curl -sSf https://sshx.io/get | sh
          
          # Ch·∫°y sshx v√† l·∫•y URL
          # L∆∞u √Ω: Ta d√πng 'script' ƒë·ªÉ t·∫°o terminal gi·∫£ l·∫≠p gi√∫p sshx xu·∫•t log link
          script -q -c 'sshx' /dev/null > sshx_log.txt &
          
          # ƒê·ª£i 10 gi√¢y ƒë·ªÉ link k·ªãp sinh ra
          sleep 10
          
          # Tr√≠ch xu·∫•t link (x√≥a c√°c k√Ω t·ª± m√†u c·ªßa terminal)
          RAW_URL=$(grep -o 'https://sshx.io/s/[^[:space:]]*' sshx_log.txt | head -n 1 | sed 's/\x1b\[[0-9;]*m//g')
          
          echo "Link t√¨m th·∫•y: $RAW_URL"

          # G·ª≠i callback v·ªÅ Backend tr√™n Pterodactyl
          # Thay domain c·ªßa b·∫°n v√†o ƒë√¢y
          curl -X POST "https://nghuyzzz.qzz.io/api/callback" \
            -H "Content-Type: application/json" \
            -d "{\"username\": \"${{ github.event.client_payload.username }}\", \"session_id\": \"${{ github.event.client_payload.session_id }}\", \"url\": \"$RAW_URL\", \"start_time\": $(date +%s)}"

          # Gi·ªØ session ch·∫°y trong 4 ti·∫øng (14400 gi√¢y)
          sleep 14400
